---
dist: xenial
language: python
python: 3.7
services: docker
env:
  global:
    - IMAGE_NAME=dhsncats/gophish
    - DOCKER_USER=felddy
    - secure: >-
        muk2wkJOSLH1oHCaGdqhzwJsT2wDAKvCxN+4p2luCYXTwc4MsQTkEfSB0OvsU3kmdhP
        xcPVrVsJIVFlAjwbHKXRkZFKFicOlznOjtADA9LhUL16wZALwTt6kh/EuPvAubDRCPQ
        P5720zJMV+LJRFPK21z+A420ngwS9BHT/xJ5qP7wnzElcxt/FFaLSjorrsBHW7GGyXs
        RfLrEJalFnOViK0v9rgHR+0Mq1E0OS2feIRieoVV3Ja3dejSRj/8Pys4n2ozb5Z9pF+
        8LxCvnRp2jckjgsqbe3INrX/yh6hZFG1kKRC7lg2vqMbUuJUDEyrLeXzZmWm69KuSl+
        z/+a1AQPIa2W+phHjKQbNshUX3DMnKjb2jh0/a3Wi/SG7xEK/G45Y8kZsBjF9xd9DDf
        zfvQBbY/gvKtFoJYOWHaqzXy832PQmVNtc9jVDBQ0LcWtZl6fEbYOUXbsrvlOvNu1Ba
        WC+a6okC2eszlwprhkNO+n/T3XrH1b91wA6Hy7bjFOCgGKMcGLCglRxXCViqg8x5EDz
        Al0GQTVvzaIAPI7mYA5cS30wybfUKiVwAHaO4eGoC6l0DUqRkthfBatl0XkRBMlC+IB
        /63R7rvhpRlEURq8KIh8B2Un5bbu7p27GKbgyo5rnwGiBxQB0LnijRjVwEHfDfknDjv
        EES6lTHACupbQ=
cache:
  pip: true
  directories:
    - "$HOME/.cache/pre-commit"
install:
  - pip install --upgrade -r requirements-test.txt
  - travis_scripts/build_docker_image.sh
before_script:
  - docker-compose up -d
script:
  - pre-commit run --all-files
  - pytest -v
after_script:
  - docker-compose down
deploy:
  - provider: script
    script: bash travis_scripts/deploy_to_docker_hub.sh
    on:
      tags: true
      python: '3.7'
