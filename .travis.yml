---
dist: xenial
language: python
python: 3.7
services: docker
env:
  global:
    - IMAGE_NAME=dhsncats/gophish
    - DOCKER_USER=felddy
    - secure: >-
        dXQZmRrYx2WHdbEnASku5rjqGw42bNUn7mBdAMB0zTHqybbGPOPDbww3Sgy3rEyExn0
        OnTfj94zV8M53SM1DGiuXOhAIB6SY6LeVfbuLkJD+Mb3HbrnDQZjEYAjdD+IyDs9d2D
        1FJqleRDxZSJwbFCvQ2HzA3q2QfeKGe30U1Jm8QkEkZIFJqxIQ/zj0dV9SVw68uqth9
        hCAIwr9YFWH9HU6/56CdgFe8rRvw1ESJpoh776/D1bcp8jU6kcm+ivzKXrGxOAGL4X2
        kbYe3KrAl0q2ZA1RbaiuHS81cZ6hz8HZnoj8Ni6PDvNZwY3Yotw2jK+MpofHzcKQm+5
        9t/xcscuLF4e/XdjNRMJES8l7o4jpGOIGfcM4k2mT/F+h4qqN6Wku6WGnPp7kU8NNi8
        bwAJSA2eKu5o583+Sa4iGlrbHmLiz3DVGTLxu6QzezaCFGHxieuoOqkhXfXtSiRmZTU
        VCacjwB3IhNq77r9T2QIDby2cauGHtR57UcznPXv13g3JyIvUER4i+U36vVj9nahptf
        QqaSlvMe9YTifsHygMJAWZ1girbZkcIMYa2DqCTKKZJ4OSh60PY/TRXzzDzNXRroEtc
        01DU19lho2EucQMrFavz43TjEGUW6HZlL1pknlrqkZM5hskuEtPFrh/wLR0GVu7OJTx
        WRWuGcb146yuU=
cache:
  pip: true
  directories:
    - "$HOME/.cache/pre-commit"
install:
  - pip install --upgrade -r requirements-test.txt
  - travis_scripts/build_docker_image.sh
before_script:
  - docker-compose up -d
script:
  - pre-commit run --all-files
  - pytest -v
after_script:
  - docker-compose down
deploy:
  - provider: script
    script: bash travis_scripts/deploy_to_docker_hub.sh
    on:
      tags: true
      python: '3.7'
